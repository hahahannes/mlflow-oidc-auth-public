{% macro table_block(table_id, table_header, data, data_type) %}
<div class="table-block">
    <div class="block-header">
        <h2>{{ table_header }}</h2>
        <div class="search-container">
            <input type="text" id="searchInput_{{ table_id }}" placeholder="Search...">
            <button id="addPermissions_{{ table_id }}">Add</button>
        </div>
    </div>
    <table id="dataTable_{{ table_id }}">
        <thead>
            <tr>
                <th>Name</th>
                <th>Permission</th>
                <th>Manage</th>
            </tr>
        </thead>
        <tbody>
        {% for item in data %}
        <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.permission }}</td>
            <td><button class="view-manage-button" data-id="{{ item.name }}">Update</button></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% set permission_who = current_username %}
    {% include '_popup_manage_permissions.html' %}
</div>
{% endmacro %}

{{ table_block('experiment', 'Experiments', experiments, 'experiment') }}
{{ table_block('model', 'Models', models, 'model') }}

<script>
document.addEventListener('DOMContentLoaded', () => {
    const filterTable = (searchInput, table_id) => {
        const filter = searchInput.value.toLowerCase();
        const rows = document.querySelectorAll('#dataTable_' + table_id + ' tbody tr');

        rows.forEach(row => {
            const columns = row.querySelectorAll('td');
            let found = false;

            columns.forEach(column => {
                if (column.textContent.toLowerCase().includes(filter)) {
                    found = true;
                }
            });

            if (found) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    };

    ['experiment', 'model'].forEach(table_id => {
        const searchInput = document.getElementById('searchInput_' + table_id);

        searchInput.addEventListener('keyup', () => filterTable(searchInput, table_id));

        searchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
            } else if (event.key === 'Escape') {
                searchInput.value = '';  // Clear search input
                filterTable(searchInput, table_id);  // Reset table filtering
            }
        });

        ['experiment', 'model'].forEach(table_id => {
        const searchInput = document.getElementById('searchInput_' + table_id);
        const table = document.getElementById('dataTable_' + table_id);

        searchInput.addEventListener('keyup', () => {
            const filter = searchInput.value.toLowerCase();
            const rows = table.getElementsByTagName('tr');

            let found = false;
            for (let i = 1; i < rows.length; i++) {
                const name = rows[i].getElementsByTagName('td')[0].textContent;
                if (name.toLowerCase().indexOf(filter) > -1) {
                    rows[i].style.display = '';
                    found = true;
                } else {
                    rows[i].style.display = 'none';
                }
            }

            if (!found && filter !== '') {
                alert('Data does not exist');
            }
        });
      });
    });
});
</script>