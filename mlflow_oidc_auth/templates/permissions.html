<!DOCTYPE html>
<html lang="en-US">
{% set title = "Permissions " ~ active_tab %}
{% include '_head.html' %}

<body>
    {% include '_header.html' %}
    <div class="content">
        <div class="tabs">
            <a href="{{ url_for('permissions_users') }}" class="{% if active_tab == 'users' %}active{% endif %}">Users
                Permissions</a>
            <a href="{{ url_for('permissions_experiments') }}"
                class="{% if active_tab == 'experiments' %}active{% endif %}">Experiments Permissions</a>
            <a href="{{ url_for('permissions_models') }}"
                class="{% if active_tab == 'models' %}active{% endif %}">Models
                Permissions</a>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="{{ active_tab }} search...">
        </div>

        <table id="dataTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item }}</td>
                    <td><button class="view-manage-button" data-id="{{ item }}">View/Manage</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const searchInput = document.getElementById('searchInput');
                const dataTable = document.getElementById('dataTable');
                const viewButton = document.querySelectorAll('.view-manage-button');

                searchInput.addEventListener('keyup', () => {
                    const filter = searchInput.value.toLowerCase();
                    const rows = document.querySelectorAll('#dataTable tbody tr');
                    rows.forEach(row => {
                        const name = row.querySelector('td:first-child').textContent.toLowerCase();
                        if (name.includes(filter)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
                searchInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        searchInput.value = '';
                        const rows = document.querySelectorAll('#dataTable tbody tr');
                        rows.forEach(row => {
                            row.style.display = '';
                        });
                    }
                });
                dataTable.addEventListener('click', (event) => {
                    if (event.target && event.target.className === 'view-manage-button') {
                        const elementId = event.target.getAttribute('data-id');
                        window.location.href = `/oidc/permissions/{{ active_tab }}/${elementId}`;
                    }
                });

                searchInput.addEventListener('keyup', () => {
                    const filter = searchInput.value.toLowerCase();
                    const rows = document.querySelectorAll('#dataTable tbody tr');
                    let found = false;
                    rows.forEach(row => {
                        const name = row.querySelector('td:first-child').textContent.toLowerCase();
                        if (name === filter) {
                            row.style.display = '';
                            found = true;
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    if (!found && filter !== '' && filter.length === name.length) {
                        alert('Name does not exist');
                    }
                });

                // Add click event listener to each button
                viewButton.forEach(button => {
                    button.addEventListener('click', () => {
                    // Get the data-id value
                      const dataId = button.getAttribute('data-id');

                    // Store the data-id value in local storage
                       localStorage.setItem('dataId', dataId);
        });
    });
});
        </script>


    </div>
    {% include '_footer.html' %}
</body>

</html>